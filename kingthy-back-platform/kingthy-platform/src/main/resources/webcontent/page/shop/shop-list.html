<!DOCTYPE HTML>
<html>

<head>
	<meta charset="utf-8">
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
	<link rel="stylesheet" type="text/css" href="../../css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="../../css/h-ui/css/H-ui.css" />
	<link rel="stylesheet" type="text/css" href="../../css/plugins/bootstrap-table/bootstrap-table.min.css">
	<!-- Sweet Alert -->
	<link rel="stylesheet" type="text/css" href="../../css/plugins/sweetalert/sweetalert.css">
	<link rel="stylesheet" type="text/css" href="../../plugins/cityPicker/css/cityPicker.css">


	<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
	<title>体验店-列表</title>
	<style>
		.ul-img-list {
			list-style: none;
			margin: 0;
			padding: 0;
		}

		.ul-img-list li {
			float: left;
			margin-right: 10px
		}
	</style>
</head>

<body>
	<!--导航-->
	<nav class="breadcrumb"><i class="glyphicon glyphicon-home"></i> 首页 <span class="c-gray en">&gt;</span> 体验店管理 <span class="c-gray en">&gt;</span>		体验店数据
		<a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);"
		 title="刷新"><i class="glyphicon glyphicon-refresh"></i></a>
	</nav>

	<div class="page-container">
		<!--查询-->
		<div class="text-c" id="search_app">
			<form class="form-inline">
				<div class="form-group">
					<input type="text" class="form-control" value="" id="name" name="name" v-model="model.name" placeholder="体验店名称" />
					<input type="text" id="cityChoice" class="form-control" v-model="model.city" placeholder="所属城市" />
					<input type="hidden" id="province" value="" class="form-control" />
					<input type="hidden" id="city" value="" class="form-control" />
				</div>
				<div class="form-group">
					<label class="control-lable">创建时间：</label>
					<input type="text"     id="beginDate"   onfocus="WdatePicker({ maxDate:'#F{$dp.$D(\'beginDate\')||\'%y-%M-%d\'}' })"    class="input-text Wdate"
					 style="width:120px;"> -
					<input type="text"     id="endDate"   onfocus="WdatePicker({ minDate:'#F{$dp.$D(\'endDate\')}',maxDate:'%y-%M-%d' })"  class="input-text Wdate"
					 style="width:120px;">
				</div>
				<div class="form-group">
					<label class="control-lable">状态：</label>
					<select name="" class=" form-control" placeholder="状态" v-model="model.status">
			           <option value="" ></option>
			           <option value="true">显示</option>
			           <option value="false">隐藏</option>
		            </select>
				</div>
				<div class="form-group">
					<span class="btn btn-success" type="button" @click="searchShop"><i class="glyphicon glyphicon-search"></i>查询 </span>
				</div>
			</form>
		</div>
		<!--操作按钮-->
		<div class="cl pd-5 bg-1 bk-gray mt-20">
			<span class="l">
		       <a class="btn btn-sm btn-primary" data-title="新增" onclick="add()" href="javascript:;"><i class="glyphicon glyphicon-plus"></i> 新增</a>
		    </span>
		</div>
		<!--数据列表-->
		<div id="data_list" class="mt-20">
			<table id="tablelist" class="table table-border table-bordered table-hover table-bg">
				<thead>
					<tr class="text-c">
						<th data-formatter="indexFormatter" data-width="50px">序号</th>
						<th data-field="id" data-visible="false">id</th>
						<th data-field="name" data-halign="left" data-valign="middle" data-align="left">店名</th>
						<th data-field="city" data-halign="left" data-valign="middle" data-align="left">所属城市</th>
						<th data-field="address" data-halign="left" data-valign="middle" data-align="left">店铺地址</th>
						<th data-field="telephone" data-halign="left" data-valign="middle" data-align="left">联系电话</th>
						<th data-field="businessTime" data-formatter="businessTimeFormatter" data-halign="left" data-valign="middle" data-align="left">营业时间</th>
						<th data-field="description" data-halign="left" data-valign="middle" data-align="left">店铺介绍</th>
						<th data-field="image" data-formatter="imageFormatter" data-halign="left" data-valign="middle" data-align="left">上传照片</th>
						<th data-field="status" data-formatter="statusFormatter" data-halign="left" data-valign="middle" data-align="left">状态</th>
						<th data-field="action" data-width="150px" data-formatter="actionFormatter" data-events="operateEvents" data-halign="center"
						 data-valign="middle" data-align="center">操作</th>
					</tr>
				</thead>
			</table>
		</div>
	</div>




	<script type="text/javascript" src="../../js/jquery.min.js?v=2.1.4"></script>
	<script type="text/javascript" src="../../js/bootstrap.min.js"></script>
	<script type="text/javascript" src="../../plugins/layer/2.4/layer.js"></script>
	<script type="text/javascript" src="../../plugins/sweetalert/sweetalert.min.js"></script>
	<script type="text/javascript" src="../../js/common.js"></script>
	<script type="text/javascript" src="../../js/vue.min.js"></script>
	<script type="text/javascript" src="../../js/axios.min.js"></script>
	<script type="text/javascript" src="../../js/axios-config.js"></script>
	<script type="text/javascript" src="../../js/table.js"></script>
	<script type="text/javascript" src="../../plugins/bootstrap-table/bootstrap-table.min.js"></script>
	<script type="text/javascript" src="../../plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
	<script type="text/javascript" src="../../plugins/cityPicker/js/cityPicker.js"></script>
	<script type="text/javascript" src="../../plugins/cityPicker/js/cityData.js"></script>
	<script type="text/javascript" src="../../plugins/My97DatePicker/4.8/WdatePicker.js"></script>
	<script type="text/javascript">
		//查询
		var vm = new Vue({

			el: '#search_app',
			//数据
			data: {
				//定义用于绑定的一个对象
				model: {},
				cityData: [],//地区数据
			},
			//加载页面时执行
			created: function () {

				this.initShop();
			},
			//完成挂载
			mounted: function () {
				//城市选择器
				var cityPicker = new IIInsomniaCityPicker({
					data: cityData,
					target: '#cityChoice',
					valType: 'k-v',
					hideCityInput: '#city',
					hideProvinceInput: '#province',
					callback: function (city_id, city_name) {
						vm.model.city = city_name;
					}
				});
				cityPicker.init();
			},
			//方法
			methods: {
				initShop: function () {
					var setting = {
						tableId: '#tablelist',
						url: zmme + '/shop/query',
						method: 'post',
						pagination: true
					};
					//初始化表格
					initTable(setting);
				},
				//查询数据
				searchShop: function () {
					var setting = {
						tableId: '#tablelist',
						url: zmme + '/shop/query'
					};
					//查询条件
					var data = this.model;
					data.beginDate=$('#beginDate').val();
					data.endDate=$('#endDate').val();
					deleteEmptyProperty(data);
					console.log(JSON.stringify(data));
					searchTable(setting, data);
				}
			}
		})


		//添加操作按钮
		function actionFormatter(value, row, index) {
			var hideOrView = '显示';
			var color = 'red';
			if (row.status) {
				hideOrView = '隐藏';
				color = 'blue';
			}
			var html = '<div>';
			html += '<a class="btnHideOrView btn"  title="' + hideOrView + '"   ><i  style="color:' + color + '" class="glyphicon glyphicon-ban-circle"></i></a>';
			html += '<a class="btnEdit btn"  title="编辑"   ><i  class="glyphicon glyphicon-edit"></i></a>';
			html += '<a class="btnDel  btn"  title="删除"   ><i class="glyphicon glyphicon-trash"></i></a>';
			html += '</div>';
			return [
				html
			].join('');
		}
		//注册按钮点击事件
		window.operateEvents = {
			'click .btnHideOrView': function (e, value, row, index) {
				hideOrView(row);
			},
			'click .btnEdit': function (e, value, row, index) {
				edit(row);
			},

			'click .btnDel': function (e, value, row, index) {
				del(row);
			}
		};
		//新增
		function add(row) {
			var index = layer.open({
				type: 2,
				title: '新增->体验店',
				content: "shop-detail.html?operate=add",
				end: function () {
					refreshTable('#tablelist');
				}
			});
			layer.full(index);

		}
		//隐藏或显示
		function hideOrView(row) {
			//row为当前行数据，json数据
			var data = { id: row.id, uuid: row.uuid };
			if (row.status) {
				data.status = false;
			} else {
				data.status = true;
			}
			axios.put(zmme + "/materielCategory/update", data).then((response) => {
				var result = response.data;
				if (result.code == 0) {
					refreshTable('#tablelist');
				} else {
					swal("错误", result.message, "error");
				}

			});
		}
		//编辑
		function edit(row) {
			var index = layer.open({
				type: 2,
				title: '编辑->体验店',
				content: "shop-detail.html?operate=update&uuid=" + row.uuid,
				end: function () {
					refreshTable('#tablelist');
				}
			});
			layer.full(index);


		}
		//删除
		function del(row) {
			//row为当前行数据，json数据
			swal({
				title: "您确定要删除这条信息吗",
				text: "删除后将无法恢复，请谨慎操作！",
				type: "warning",
				showCancelButton: true,
				confirmButtonColor: "#DD6B55",
				confirmButtonText: "删除",
				closeOnConfirm: false
			}, function () {
				console.log(row.uuid);
				axios.delete(zmme + "/shop/delete/" + row.uuid).then((response) => {
					var result = response.data;
					if (result.code == 0) {
						refreshTable('#tablelist');
						swal("删除成功！", "您已经永久删除了这条信息。", "success");

					} else {
						swal("删除失败！", result.message, "error");
					}

				});

			});
		}
		function statusFormatter(value, row, index) {
			var div = "-";
			if (value == 0) {
				div = "隐藏";
			}
			if (value == 1) {
				div = "显示";
			}
			return div;
		}
		function businessTimeFormatter(value, row, index) {

			if (row.openTime && row.closeTime) {

				/*var beginTimespan = new Date(row.openTime);
				var endTimespan = new Date(row.closeTime);
				var strBeginTime = beginTimespan.getHours() + ":" + beginTimespan.getMinutes();
				var strEndTime = endTimespan.getHours() + ":" + endTimespan.getMinutes();
				return strBeginTime + "—" + strEndTime;*/
				return row.openTime + "—" + row.closeTime;
			}
			else {
				return '';
			}
		}
		function imageFormatter(value, row, index) {
			var strImage = row.image;
			var div = '<ul class="ul-img-list">';
			if (strImage) {
				var strImages = strImage.split(',');
				for (var i in strImages) {
					var img = '<li>'
						+ '<img src="' + strImages[i] + '"  style="width:60px;height:60px" />'
						+ '</li>'
					div += img;
				}
			}
			return div + '</ul>';

		}
	</script>

</body>

</html>
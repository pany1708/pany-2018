<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.kingthy.platform.mapper.message.MessageInfoMapper" >
  <resultMap id="BaseResultMap" type="com.kingthy.platform.entity.message.MessageInfo" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="uuid" property="uuid" jdbcType="CHAR" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="modify_date" property="modifyDate" jdbcType="TIMESTAMP" />
    <result column="del_flag" property="delFlag" jdbcType="BIT" />
    <result column="creator" property="creator" jdbcType="VARCHAR" />
    <result column="modifier" property="modifier" jdbcType="VARCHAR" />
    <result column="version" property="version" jdbcType="INTEGER" />
    <result column="title" property="title" jdbcType="VARCHAR" />
    <result column="content" property="content" jdbcType="VARCHAR" />
    <result column="url" property="url" jdbcType="VARCHAR" />
    <result column="push_time" property="pushTime" jdbcType="TIMESTAMP" />
    <result column="message_platform_uuid" property="messagePlatformUuid" jdbcType="CHAR" />
    <result column="members_uuid" property="membersUuid" jdbcType="CHAR" />
    <result column="member_name" property="memberName" jdbcType="VARCHAR" />
    <result column="push_target" property="pushTarget" jdbcType="INTEGER" />
    <result column="push_status" property="pushStatus" jdbcType="BIT" />
  </resultMap>

    <select id="selectMessageByUuid" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT * FROM message_info WHERE del_flag = 0 AND uuid = #{uuid}
    </select>

    <update id="updateByUuidSelective" parameterType="com.kingthy.platform.entity.message.MessageInfo" >
        update message_info
        <set >

            <if test="createDate != null" >
                create_date = #{createDate,jdbcType=TIMESTAMP},
            </if>
            <if test="modifyDate != null" >
                modify_date = #{modifyDate,jdbcType=TIMESTAMP},
            </if>
            <if test="delFlag != null" >
                del_flag = #{delFlag,jdbcType=BIT},
            </if>
            <if test="creator != null" >
                creator = #{creator,jdbcType=VARCHAR},
            </if>
            <if test="modifier != null" >
                modifier = #{modifier,jdbcType=VARCHAR},
            </if>
            <if test="version != null" >
                version = #{version,jdbcType=INTEGER},
            </if>
            <if test="title != null" >
                title = #{title,jdbcType=VARCHAR},
            </if>
            <if test="content != null" >
                content = #{content,jdbcType=VARCHAR},
            </if>
            <if test="url != null" >
                url = #{url,jdbcType=VARCHAR},
            </if>
            <if test="pushTime != null" >
                push_time = #{pushTime,jdbcType=TIMESTAMP},
            </if>
            <if test="messageType != null" >
                message_type = #{messageType,jdbcType=INTEGER},
            </if>
            <if test="membersUuid != null" >
                members_uuid = #{membersUuid,jdbcType=CHAR},
            </if>
            <if test="memberName != null" >
                member_name = #{memberName,jdbcType=VARCHAR},
            </if>
            <if test="pushTarget != null" >
                push_target = #{pushTarget,jdbcType=INTEGER},
            </if>
            <if test="pushStatus != null" >
                push_status = #{pushStatus,jdbcType=BIT},
            </if>
        </set>
        where uuid = #{uuid} AND del_flag = 0
    </update>

  <select id="findListMessage" parameterType="com.kingthy.platform.dto.message.MessageInfoReq" resultType="com.kingthy.platform.dto.message.MessageInfoDto">
    SELECT
        a.uuid,
        a.title,
        a.content,
        a.url,
        a.push_time pushTime,
        a.message_platform_uuid messagePlatformUuid,
        a.member_name memberName,
        a.push_target pushTarget,
        a.push_status pushStatus
    FROM
        message_info a
    WHERE a.del_flag = 0

    <if test="uuid != null and uuid != ''">
        AND a.uuid = #{uuid}
    </if>

    <if test="pushTarget != null and pushTarget != ''">
      AND a.pushTarget = #{pushTarget}
    </if>

    <if test="beginTime != null and beginTime != ''">
      AND  unix_timestamp(a.push_time) * 1000 &gt;= #{beginTime}
    </if>

      <if test="endTime != null and endTime != ''">
          AND  unix_timestamp(a.push_time) * 1000 &lt; #{endTime}
      </if>

      <if test="memberName != null and memberName != ''">
          AND a.member_name = #{memberName}

      </if>

      <if test="content != null and content != ''">
          AND a.content LIKE concat('%', #{content}, '%')

      </if>

  </select>

</mapper>
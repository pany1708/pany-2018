<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.kingthy.mapper.LikesMapper" >
  <cache></cache>
  <resultMap id="BaseResultMap" type="com.kingthy.entity.Likes" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="modify_date" property="modifyDate" jdbcType="TIMESTAMP" />
    <result column="version" property="version" jdbcType="INTEGER" />
    <result column="creator" property="creator" jdbcType="VARCHAR" />
    <result column="modeifier" property="modeifier" jdbcType="VARCHAR" />
    <result column="uuid" property="uuid" jdbcType="CHAR" />
    <result column="del_flag" property="delFlag" jdbcType="BIT" />
    <result column="moment_uuid" property="momentUuid" jdbcType="CHAR" />
    <result column="member_uuid" property="memberUuid" jdbcType="CHAR" />
    <result column="type" property="type" jdbcType="INTEGER" />
    <result column="status" property="status" jdbcType="INTEGER" />
  </resultMap>

  <select id="selectLikeCountByMomentUuidList" parameterType="java.util.List" resultType="com.kingthy.dto.BuyersShowListDTO$LikesDTO">
    select moment_uuid momentUuid, count(*) likeCount from likes where `type` = 2
    AND moment_uuid IN
    <foreach collection="list" item="item" index="index" open="(" separator="," close=")">
      #{item}
    </foreach>
    GROUP BY moment_uuid
  </select>

  <select id="selectLikesByMomentUuidAndMemberUuid" resultType="com.kingthy.dto.BuyersShowListDTO$LikesDTO">

    select moment_uuid momentUuid from likes where `type` = 2 and member_uuid = #{memberUuid}
    AND moment_uuid IN
    <foreach collection="list" item="item" index="index" open="(" separator="," close=")">
      #{item}
    </foreach>
  </select>


  <delete id ="deleteByMoment" parameterType="java.lang.String">
    DELETE
    FROM
    likes
    WHERE
    moment_uuid IN (
    SELECT
    uuid
    FROM
    moment_comment
    WHERE
    moment_uuid = #{momentUuid}
    )
  </delete>

  <delete id = "deleteByComment" parameterType="java.lang.String">
    DELETE
    FROM
    likes
    WHERE
    type = 1 AND moment_uuid IN (
    SELECT
    uuid
    FROM
    moment_comment
    WHERE
    uuid = #{momentCommentUuid}
    OR parent_uuid = #{momentCommentUuid}
    )
  </delete>


</mapper>